<div class="form-container">
  <!-- Success Message -->
  <div class="success-message" *ngIf="showSuccess">
    <mat-icon>check_circle</mat-icon>
    <span>Ticket created successfully!</span>
  </div>

  <!-- Form Card -->
  <div class="form-card">
    <div class="form-header">
      <mat-icon class="header-icon">confirmation_number</mat-icon>
      <div>
        <h2>Create New Ticket</h2>
        <p>Fill out the form below to submit your support request</p>
      </div>
    </div>

    <form [formGroup]="ticketForm" (ngSubmit)="onSubmit()">
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>inventory_2</mat-icon>
          Product Details
        </h3>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Select Product</mat-label>
            <mat-select formControlName="productId">
              <mat-option *ngFor="let prod of products()" [value]="prod.id">
                {{ prod.nameEn }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>apps</mat-icon>
            <mat-error *ngIf="ticketForm.get('productId')?.invalid">
              This field is required
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Contact Information Section -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>contact_mail</mat-icon>
          Contact Information
        </h3>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email Address</mat-label>
            <input matInput type="email" formControlName="email" placeholder="your@email.com" />
            <mat-icon matPrefix>email</mat-icon>
            <mat-error *ngIf="ticketForm.get('email')?.invalid">
              {{ getErrorMessage('email') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Phone Number</mat-label>
            <input matInput type="tel" formControlName="phone" placeholder="+20 123 456 7890" />
            <mat-icon matPrefix>phone</mat-icon>
            <mat-error *ngIf="ticketForm.get('phone')?.invalid">
              {{ getErrorMessage('phone') }}
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Ticket Details Section -->
      <div class="form-section">
        <h3 class="section-title">
          <mat-icon>description</mat-icon>
          Ticket Subject
        </h3>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Subject</mat-label>
            <input
              matInput
              formControlName="subject"
              placeholder="Brief description of your issue"
            />
            <mat-icon matPrefix>title</mat-icon>
            <mat-error *ngIf="ticketForm.get('subject')?.invalid">
              {{ getErrorMessage('subject') }}
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea
              matInput
              formControlName="description"
              rows="6"
              placeholder="Provide detailed information about your issue..."
            ></textarea>
            <mat-icon matPrefix>notes</mat-icon>
            <mat-error *ngIf="ticketForm.get('description')?.invalid">
              {{ getErrorMessage('description') }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Attachments Section -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>attach_file</mat-icon>
            Attachments (Optional)
          </h3>

          <div class="form-row">
            <div class="file-upload-container">
              <input
                type="file"
                #fileInput
                (change)="onFileSelected($event)"
                accept="image/*,.pdf,.doc,.docx"
                multiple
                hidden
              />

              <button
                mat-stroked-button
                type="button"
                (click)="fileInput.click()"
                class="upload-btn"
              >
                <mat-icon>cloud_upload</mat-icon>
                Choose Files
              </button>

              <p class="upload-hint">Supported: Images, PDF, Word documents (Max 5MB per file)</p>
            </div>
          </div>

          <!-- Selected Files Preview -->
          <div class="selected-files" *ngIf="selectedFiles().length > 0">
            <h4 class="files-title">
              <mat-icon>attachment</mat-icon>
              Selected Files ({{ selectedFiles().length }})
            </h4>

            <div class="files-list">
              <div class="file-item" *ngFor="let file of selectedFiles(); let i = index">
                <div class="file-info">
                  <mat-icon class="file-icon">insert_drive_file</mat-icon>
                  <div class="file-details">
                    <span class="file-name">{{ file.name }}</span>
                    <span class="file-size">{{ getFileSize(file.size) }}</span>
                  </div>
                </div>
                <button
                  mat-icon-button
                  type="button"
                  (click)="removeFile(i)"
                  class="remove-btn"
                  [attr.aria-label]="'Remove ' + file.name"
                >
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button
          mat-flat-button
          color="primary"
          type="submit"
          [disabled]="isSubmitting()"
          class="submit-btn"
        >
          <mat-icon>send</mat-icon>
          <span>{{ isSubmitting() ? 'Creating Ticket...' : 'Create Ticket' }}</span>
        </button>

        <button
          mat-stroked-button
          type="button"
          (click)="onReset()"
          [disabled]="isSubmitting()"
          class="reset-btn"
        >
          <mat-icon>refresh</mat-icon>
          Reset Form
        </button>
      </div>
    </form>
  </div>
</div>
